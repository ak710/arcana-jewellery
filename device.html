<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcana â€” Device View</title>
    <link rel="icon" type="image/png" href="Favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
      @font-face {
        font-family: 'KudryashevDisplay';
        src: url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.eot');
        src: url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.eot?#iefix') format('embedded-opentype'),
             url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.woff2') format('woff2'),
             url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.woff') format('woff'),
             url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.ttf') format('truetype'),
             url('https://db.onlinewebfonts.com/t/157c6cc36dd65b1b2adc9e7f3329c761.svg#KudryashevDisplay') format('svg');
      }
      .logo { font-family: 'KudryashevDisplay', serif; }
    </style>
        <script>
            window.tailwind = window.tailwind || {};
            window.tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            cream: '#FAF9F6',
                            gold: '#C9A961',
                            'gold-dim': '#A68B4F',
                            'gold-light': '#E8D9B0',
                            'arcana-charcoal': '#0F0F0F',
                            'arcana-ebony': '#1A1A1A'
                        }
                    }
                }
            };
        </script>
        <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css">
        <script src="theme.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-cream dark:bg-gradient-to-b dark:from-[#0F0F0F] dark:to-[#1A1A1A]">
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
      <span id="theme-icon">ðŸŒ™</span>
    </button>

    <!-- 3D Background -->
    <div id="canvas-container"></div>

    <!-- MAIN UI CONTAINER -->
    <div id="app" class="relative w-full h-full z-10 overflow-hidden">

        <!-- SCREEN 1: CONNECTING (NFC HANDSHAKE) -->
        <div id="screen-connect" class="screen active">
            <div class="relative flex flex-col items-center justify-start h-full w-full pt-16 md:pt-20">
                <div class="nfc-ring ripple-anim"></div>
                <div class="nfc-ring ripple-anim" style="animation-delay: 0.6s;"></div>
                
                <div class="z-10 text-center w-full px-6">
                    <div class="logo text-5xl text-dark mb-6">Arcana</div>
                    <i data-lucide="waves" class="w-12 h-12 text-gold mb-4 mx-auto opacity-70"></i>
                    <h2 class="text-xl tracking-[0.3em] uppercase text-medium mb-2 text-xs font-light">Reading Tag</h2>
                    <h1 id="status-text" class="serif text-3xl text-dark font-bold glowing-text">Establishing Link...</h1>
                    <div class="loader-container mx-auto mt-6">
                        <div id="loader-progress" class="loader-bar"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN 2: WELCOME -->
        <div id="screen-welcome" class="screen hidden-up">
            <div class="w-full h-full flex flex-col justify-between p-8 pt-16 pb-12 overflow-y-auto">
                
                <!-- Top Branding -->
                <div class="text-center fade-in-element opacity-0" style="transition-delay: 0.2s;">
                    <div class="logo text-5xl text-dark mb-6">Arcana</div>
                    <p id="item-id-label" class="text-xs tracking-[0.4em] text-gold uppercase mb-3 font-light"></p>
                    <h1 class="serif text-5xl md:text-6xl font-bold text-dark leading-tight mb-2">
                        Welcome to your <br>
                        <span class="text-gold">Portal</span>
                    </h1>
                </div>

                <!-- Middle Indicator (The 3D object is centered here visually) -->
                <div class="flex-grow flex items-center justify-center">
                </div>

                <!-- Bottom Actions -->
                <div class="w-full max-w-md mx-auto space-y-4 fade-in-element opacity-0" style="transition-delay: 0.6s;">
                    <div class="glass-panel p-6 rounded-2xl text-center transform transition hover:scale-[1.01] border border-gold/20">
                        <p class="text-medium text-sm mb-2 font-light">You have a new memory attached</p>
                        <p id="message-from" class="serif text-2xl text-dark"></p>
                    </div>

                    <button onclick="goToMessage()" class="btn-gold w-full py-4 rounded-xl flex items-center justify-center gap-2">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        <span>Reveal Message</span>
                    </button>
                    
                    <button onclick="goToDetails()" class="btn-outline-gold w-full py-4 rounded-xl flex items-center justify-center gap-2 transition-colors duration-150">
                        <i data-lucide="gem" class="w-5 h-5"></i>
                        <span>View Piece Details</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- SCREEN: DETAILS -->
        <div id="screen-details" class="screen hidden-up bg-white/95 backdrop-blur-sm">
            <div class="w-full max-w-2xl h-full overflow-y-auto p-6 pt-12 pb-20">
                
                <!-- Header -->
                <div class="flex justify-between items-center mb-8">
                    <button onclick="goBackToHome()" class="text-medium hover:text-gold transition">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <div class="logo text-3xl text-dark">Arcana</div>
                    <div class="w-6"></div>
                </div>

                <div class="text-center mb-8">
                    <h2 class="serif text-4xl text-dark font-bold mb-2">Piece Details</h2>
                    <p id="details-item-label" class="text-xs tracking-[0.4em] text-gold uppercase"></p>
                </div>

                <!-- Stone Details -->
                <div id="stone-details-section" class="details-card glass-panel p-6 rounded-2xl mb-6 border border-gold/20 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 hover:border-gold/40">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="gem" class="w-6 h-6 text-gold transition-transform duration-300 group-hover:scale-110"></i>
                        <h3 class="serif text-2xl text-dark font-semibold">Stone Details</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between detail-row opacity-0 transition-all duration-300">
                            <span class="text-medium">Size:</span>
                            <span id="stone-size" class="text-dark font-medium">â€”</span>
                        </div>
                        <div class="flex justify-between detail-row opacity-0 transition-all duration-300" style="transition-delay: 0.1s;">
                            <span class="text-medium">Quality:</span>
                            <span id="stone-quality" class="text-dark font-medium">â€”</span>
                        </div>
                    </div>
                </div>

                <!-- Metal Details -->
                <div id="metal-details-section" class="details-card glass-panel p-6 rounded-2xl mb-6 border border-gold/20 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 hover:border-gold/40">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="sparkles" class="w-6 h-6 text-gold transition-transform duration-300 group-hover:scale-110"></i>
                        <h3 class="serif text-2xl text-dark font-semibold">Metal Details</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between detail-row opacity-0 transition-all duration-300">
                            <span class="text-medium">Type:</span>
                            <span id="metal-type" class="text-dark font-medium">â€”</span>
                        </div>
                        <div class="flex justify-between detail-row opacity-0 transition-all duration-300" style="transition-delay: 0.1s;">
                            <span class="text-medium">Purity:</span>
                            <span id="metal-purity" class="text-dark font-medium">â€”</span>
                        </div>
                    </div>
                </div>

                <!-- Certification -->
                <div id="certification-section" class="details-card glass-panel p-6 rounded-2xl mb-6 border border-gold/20 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 hover:border-gold/40">
                    <div class="flex items-center gap-3 mb-4">
                        <i data-lucide="award" class="w-6 h-6 text-gold transition-transform duration-300 group-hover:rotate-12"></i>
                        <h3 class="serif text-2xl text-dark font-semibold">Certification</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center detail-row opacity-0 transition-all duration-300">
                            <span class="text-medium">Certificate:</span>
                            <span id="cert-provider" class="text-dark font-medium">â€”</span>
                        </div>
                        <a id="cert-link" href="#" target="_blank" class="hidden btn-gold w-full py-3 rounded-lg flex items-center justify-center gap-2 transform transition-all duration-200 hover:scale-105 hover:shadow-2xl">
                            <i data-lucide="external-link" class="w-4 h-4"></i>
                            <span>View Certificate</span>
                        </a>
                    </div>
                </div>

            </div>
        </div>

        <!-- SCREEN: NOT FOUND -->
        <div id="screen-notfound" class="screen hidden-up">
            <div class="w-full h-full flex flex-col justify-center items-center p-8">
                <div class="glass-panel p-8 rounded-2xl text-center shadow-lg border border-gold/20 max-w-xl">
                    <h2 id="notfound-title" class="serif text-3xl text-dark font-bold mb-4">Tag not recognized</h2>
                    <p id="notfound-msg" class="text-medium text-sm mb-6">We couldn't find any memory attached to this tag ID.</p>
                    <div class="flex gap-3 justify-center">
                        <a id="notfound-home" href="/" class="px-4 py-3 bg-gold text-white rounded-lg">Visit Shop</a>
                        <button id="notfound-back" class="px-4 py-3 bg-gray-100 rounded-lg">Try another tag</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SCREEN 3: THE MESSAGE -->
        <div id="screen-message" class="screen hidden-up bg-white/95 backdrop-blur-sm">
            <div class="w-full max-w-3xl h-full overflow-y-auto p-6 pt-12 pb-20">
                
                <!-- Header -->
                <div class="flex justify-between items-center mb-12">
                    <button onclick="goBackToHome()" class="text-medium hover:text-gold transition">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <div class="logo text-3xl text-dark">Arcana</div>
                    <div class="w-6"></div>
                </div>

                <!-- Title & Author -->
                <div class="text-center mb-12">
                    <h1 id="message-title" class="serif text-4xl md:text-5xl text-dark font-bold leading-tight mb-4"></h1>
                    <p id="message-sign" class="text-gold uppercase tracking-[0.3em] text-sm"></p>
                </div>

                <!-- Video Message -->
                <div class="mb-12">
                    <div class="aspect-video w-full bg-black rounded-2xl overflow-hidden shadow-2xl">
                        <iframe id="embedded-iframe" class="w-full h-full object-cover" title="Video message" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>

                <!-- Text Message (Stylized) -->
                <div class="mb-16 text-center">
                    <div class="inline-block max-w-2xl">
                        <div class="w-16 h-0.5 bg-gold mx-auto mb-6"></div>
                        <p id="message-body" class="text-xl md:text-2xl text-dark leading-relaxed font-light italic"></p>
                        <div class="w-16 h-0.5 bg-gold mx-auto mt-6"></div>
                    </div>
                </div>

                <!-- Voice Note -->
                <div id="voice-card" class="mb-12 hidden">
                    <div class="text-center mb-4">
                        <h3 class="serif text-2xl text-dark font-semibold flex items-center justify-center gap-2">
                            <i data-lucide="mic" class="w-5 h-5 text-gold"></i>
                            A Voice Note for You
                        </h3>
                    </div>
                    <div class="flex justify-center">
                        <audio id="voice-audio" controls preload="none" class="voice-player"></audio>
                    </div>
                </div>

                <!-- Song -->
                <div id="song-card" class="mb-12 hidden">
                    <div class="text-center mb-6">
                        <h3 class="serif text-2xl md:text-3xl text-dark font-semibold italic">
                            The one song that reminds me of you
                        </h3>
                    </div>
                    <div class="song-container">
                        <iframe id="song-embed" class="w-full rounded-2xl shadow-xl" style="height: 152px; border: 0;" allow="autoplay; clipboard-write; encrypted-media" loading="lazy"></iframe>
                        <div id="song-fallback" class="song-fallback-clean hidden">
                            <a id="song-link" class="btn-gold py-4 px-8 rounded-xl inline-flex items-center justify-center gap-2 text-lg" target="_blank" rel="noopener noreferrer">
                                <i data-lucide="music" class="w-5 h-5"></i>
                                <span>Listen to Our Song</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Location -->
                <div id="location-card" class="mb-16 hidden">
                    <div class="text-center mb-6">
                        <h3 class="serif text-2xl md:text-3xl text-dark font-semibold mb-2">
                            <span id="location-label"></span>
                        </h3>
                        <p class="text-medium text-sm">A place we'll always remember</p>
                    </div>
                    <div id="location-embed-wrap" class="hidden mb-6">
                        <div class="rounded-2xl overflow-hidden shadow-2xl">
                            <iframe id="location-embed" class="w-full" style="border:0; height: 400px;" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                    <div class="text-center">
                        <a id="location-link" class="btn-outline-gold py-3 px-6 rounded-xl inline-flex items-center justify-center gap-2" target="_blank" rel="noopener noreferrer">
                            <i data-lucide="navigation" class="w-4 h-4"></i>
                            <span>Open in Maps</span>
                        </a>
                    </div>
                </div>

                <!-- Jewellery Piece -->
                <div class="mb-12">
                    <div class="text-center mb-6">
                        <h3 class="serif text-2xl text-dark font-semibold">Your Jewellery Piece</h3>
                        <p class="text-xs text-medium mt-2">Authenticated Item <span id="item-id-label"></span></p>
                    </div>
                    <div class="aspect-video w-full bg-gradient-to-b from-white to-cream rounded-2xl overflow-hidden shadow-xl">
                        <iframe 
                            id="device-3d-iframe"
                            title="device-3d"
                            frameborder="0" 
                            mozallowfullscreen="true" 
                            webkitallowfullscreen="true" 
                            xr-spatial-tracking 
                            execution-while-out-of-viewport 
                            execution-while-not-rendered 
                            web-share
                            allow="camera; autoplay; fullscreen; xr-spatial-tracking; web-share" 
                            class="w-full h-full">
                        </iframe>
                    </div>
                </div>

                <!-- Share Section -->
                <div class="text-center pt-8 border-t border-gold/20">
                    <h3 class="text-lg text-dark font-semibold mb-4">Share this Memory</h3>
                    <div class="flex gap-3 justify-center max-w-md mx-auto">
                        <button onclick="shareContent()" class="flex-1 py-3 border border-gold/30 rounded-lg hover:bg-gold-light/30 transition flex items-center justify-center gap-2 text-sm text-dark font-medium">
                            <i data-lucide="send" class="w-4 h-4"></i> Share
                        </button>
                        <button onclick="copyLink()" class="flex-1 py-3 border border-gold/30 rounded-lg hover:bg-gold-light/30 transition flex items-center justify-center gap-2 text-sm text-dark font-medium">
                            <i data-lucide="link" class="w-4 h-4"></i> Copy
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <div id="toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 glass-panel px-6 py-3 rounded-full text-sm text-dark opacity-0 pointer-events-none transition-opacity duration-300 z-50 flex items-center gap-2 border border-gold/20">
        <i data-lucide="check-circle" class="w-4 h-4 text-gold"></i>
        <span id="toast-msg">Action Successful</span>
    </div>

        <!-- Main application script: three.js scene + model loader lives in `script.js` -->
        <script src="script.js"></script>

        <!-- All visible item content (model, video, message, sender) is populated
             exclusively from Supabase via `script.js`. No local fallbacks or
             hardcoded content are present in this file. -->
</body>
</html>
